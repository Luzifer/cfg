#!/bin/bash -e

set -o pipefail
set -e

STEP_COLOR="\033[0;36m"
NO_COLOR="\033[0m"

function step {
    echo -e ${STEP_COLOR}[$(date +%H:%M:%S)] $1${NO_COLOR}
}

### Determine what to push

step "Getting current branch"

CURRENT_BRANCH=$(git branch --list | awk '/^\*/{print $2}')

step "Loading required key to push"
git loadkey

step "Execute pre-push auto-hook"
git autohook pre-push

step "Execute pushes..."
git push origin ${CURRENT_BRANCH} --tags "$@"

step "Execute post-push auto-hook"
git autohook post-push
